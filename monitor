#!/bin/bash

# switch between 1-monitor- and 2-monitor-mode

IN="LVDS1"
EXT="VGA1"

# apparently, each enabled monitor produces a line containing a star in xrandr
# so, retrieve the number of enabled monitors
COUNT=$(xrandr | grep "\*" | wc -l)

external-enable () {
  xrandr --output $IN --auto --primary --set "scaling mode" "Full aspect" --pos 0x1085 \
    --output $EXT --auto
}

external-disable () {
  xrandr --output $IN --auto --primary --set "scaling mode" "Full aspect" \
    --output $EXT --off
}

case $1 in
  enable)
    # turn off external monitor if disconnected
    if (xrandr | grep "$EXT disconnected"); then
      xrandr --output $EXT --off
    else
      external-enable
    fi
    ;;
  disable)
    external-disable
    ;;
  *)
    # toggle
    # turn off external monitor if disconnected
    if (xrandr | grep "$EXT disconnected"); then
      xrandr --output $EXT --off
    else
      if [ "$COUNT" -eq 1 ]; then
        # if status is empty it's disabled: enable external monitor
        external-enable
      else
        # status is not empty it's enabled: disable external monitor
        external-disable
      fi
    fi
    ;;
esac

